# PROMPT-03: Bug 修復準備

**場景**: 準備修復 Bug 或解決已知問題
**目標**: 問題定位、影響範圍評估、修復策略制定
**預估時間**: 3-5 分鐘
**適用對象**: Bug 修復、問題調查、錯誤排除

---

## 🎯 使用方式

```
開發者: @PROMPT-03-BUG-FIX-PREP.md BUG-001
AI: [執行以下指令,分析 BUG-001]
```

**變數說明**:
- `[BUG-ID]`: Bug 編號或問題描述
- 如果未提供 Bug ID,請詢問開發者問題描述

---

## 🤖 AI 執行指令

當開發者引用此 Prompt 時,請按以下順序執行:

### 步驟 1: 問題信息收集
**讀取文件** (如果 Bug 已記錄):
- `claudedocs/5-status/PROJECT-STATUS-REPORT.md` (已知問題區塊)
- `claudedocs/4-changes/CHANGE-LOG.md` (相關變更歷史)

**詢問開發者** (如果 Bug 未記錄):
- 問題描述 (現象、錯誤訊息)
- 復現步驟
- 預期行為 vs 實際行為
- 發生頻率 (偶發/頻繁/必現)
- 影響範圍 (模組、功能)

**輸出**:
```markdown
## 🐛 Bug 信息

### 基本信息
- **Bug ID**: [編號或新建]
- **嚴重性**: [Critical/High/Medium/Low]
- **狀態**: [New/Investigating/In Progress]
- **報告日期**: [日期]

### 問題描述
[詳細描述]

### 復現步驟
1. [步驟 1]
2. [步驟 2]
...

### 預期 vs 實際
- **預期**: [正確行為]
- **實際**: [錯誤行為]

### 影響範圍
- **影響模組**: [列出]
- **影響功能**: [列出]
- **影響用戶**: [描述]
```

---

### 步驟 2: 問題定位分析
**執行代碼搜索**:
```bash
# 搜索錯誤訊息相關代碼
grep -r "錯誤訊息關鍵字" "C:\ai-semantic-kernel-project\src" --include="*.cs"

# 搜索相關功能模組
find "C:\ai-semantic-kernel-project\src" -name "*[相關模組]*.cs"

# 檢查最近變更
git log --since="1 week ago" --oneline -- [相關路徑]
```

**讀取相關代碼文件**:
- 根據搜索結果讀取可疑的代碼文件

**輸出**:
```markdown
## 🔍 問題定位分析

### 可疑代碼位置
- **文件**: [路徑:行號]
- **函數/類**: [名稱]
- **代碼片段**: [相關代碼]

### 可能原因
1. [原因 1] - [可能性: High/Medium/Low]
2. [原因 2] - [可能性: High/Medium/Low]

### 相關變更
- [最近的相關提交] - [日期] - [描述]
```

---

### 步驟 3: 影響範圍評估
**分析依賴關係**:
```bash
# 搜索調用該功能的代碼
grep -r "問題函數名" "C:\ai-semantic-kernel-project\src" --include="*.cs"

# 檢查相關測試
find "C:\ai-semantic-kernel-project\tests" -name "*[相關功能]*Tests.cs"
```

**輸出**:
```markdown
## 📊 影響範圍評估

### 代碼層面
- **直接影響**: [文件數量、函數數量]
- **間接影響**: [依賴此功能的模組]
- **測試影響**: [需要更新的測試]

### 功能層面
- **核心功能**: [是/否]
- **影響範圍**: [局部/模組/系統]
- **用戶影響**: [描述]

### 風險評估
- **修復風險**: [Low/Medium/High]
- **回歸風險**: [可能引入新問題的風險]
```

---

### 步驟 4: 修復策略制定
**讀取架構文檔** (如果需要):
- `docs/architecture/backend-architecture.md`
- `docs/architecture/database-schema.md`

**輸出**:
```markdown
## 🔧 修復策略

### 推薦方案
- **方案**: [描述修復方法]
- **修改範圍**: [需要修改的文件]
- **預估時間**: [X hours]
- **風險**: [Low/Medium/High]

### 備選方案 (如適用)
- **方案**: [描述]
- **優點**: [列出]
- **缺點**: [列出]

### 測試策略
1. [ ] 單元測試: [測試內容]
2. [ ] 集成測試: [測試內容]
3. [ ] 手動驗證: [驗證步驟]

### 預防措施
- [如何防止類似問題再次發生]
```

---

### 步驟 5: 修復前檢查清單
**輸出**:
```markdown
## ✅ 修復前檢查清單

### 問題理解
- [ ] 已復現問題
- [ ] 已定位根本原因
- [ ] 已評估影響範圍
- [ ] 已制定修復策略

### 環境準備
- [ ] 代碼已更新到最新版本
- [ ] 創建 bugfix 分支: `bugfix/[bug-id]-[description]`
- [ ] 相關測試可執行

### 修復計劃
- [ ] 修復步驟清晰
- [ ] 測試計劃完整
- [ ] 回歸測試範圍確定

### 下一步行動
1. 創建 bugfix 分支
2. 實施修復方案
3. 執行測試驗證
4. 使用 `@PROMPT-08-CODE-REVIEW.md` 進行代碼審查
```

---

## 🎯 最終輸出摘要

**修復可行性評估**:
- ✅ **可以開始修復**: [如果問題已定位且策略清晰]
- ⚠️ **需要更多調查**: [列出需要進一步分析的點]

**優先級建議**:
- [Critical/High/Medium/Low] - [理由]

---

## 📊 預期輸出

- **輸出長度**: ~1500-2000 字
- **文檔讀取數量**: ~3-5 個文件
- **代碼搜索**: 3-5 次
- **執行時間**: 3-5 分鐘

---

**版本**: 2.0.0
**最後更新**: 2025-12-08
**維護者**: Development Team
